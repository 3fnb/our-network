# 5장. 네트워크 계층: 데이터 전달하기

## OSI : 4단계 네트워크계층

`네트워크 간`의 통신을 가능하게 하는것이 네트워크계층의 역할이다. 라우터라는 장비가 필요하며, 라우터별로 공인IP가 부여된다. 

## IP(internet protocol)

네트워크 계층에서 데이터를 다른 네트워크로 전송하려면 IP가 필요하다. 데이터 앞에 `IP헤더`가 붙어 캡슐화되며, IP내부에는 출발지 IP주소와 도착지 IP주소가 담겨있다. IP주소를 통해 어떤 네트워크에 있는 어떤컴퓨터로 데이터를 전송할 것인지 확인 할 수 있다. IP헤더로 캡슐화된 결과물을 `IP패킷`이라고도 부른다. 

## IP주소

IP주소는 인터넷 서비스 제공자(ISP)로부터 부여받을 수 있다. 주소의 방식에는 IPv4, IPv6가 있는데 기존 IPv4의 IP주소가 모자라서 확장된 버전이 IPv6이다. 지금은 혼용하고있다. IP주소에는 `공인IP`와 `사설IP`로 나뉘는데, 공인IP는 라우터에만 할당하고, 네트워크 내부에서 사설IP를  DHCP(Dynamic Host Configuration Protocol)사설IP의 동적할당을 사용하여 자동부여된다. 

- 공인IP ⇒ 라우터나 인터넷에 직접연결되는 컴퓨터
- 사설IP ⇒ 개인 컴퓨터

IP주소는 4개의 `옥탯`으로 구성되는데 (IPv4 기준) 각 옥텟마다 8비트의 진수가 들어가며 사람이 읽기변하도록 10진수로도 표현한다.(0~255) IP주소 구성을 살펴보면 `네트워크ID`(어떤 네트워크인가?)와 `호스트ID`(해당 네트워크의 어떤 컴퓨터 인가?)로 또 구분된다. 이 구분은 각각 옥탯을 몇 개씩 사용하느냐에 따라서 A, B, C클래스로 나뉜다. 

                       네트워크ID : 호스트ID

- A class ⇒     1옥텟    :    3옥텟
- B class ⇒     2옥텟    :    2옥텟
- C class ⇒     3옥텟    :    1옥텟

A 네트워크 개수 적고 호스트 개수 많음 ⇒ 대규모 네트워크 적합

C 네트워크 개수 많고 호스트 개수 적음 ⇒ 소규모 네트워크 적합

각 클래스 내부에서도 공인IP와 사설IP범위가 나뉘며, 가정의 랜에서는 보통 C클래스의 사설IP주소인 192.168.xx.xx 가 주소 사용된다.

## 네트워크 주소와 브로드캐스트 주소

각 네트워크마다 2가지의 특정된 주소가 부여되는데 IP주소의 마지막 옥텟이 각각 0, 255인 IP주소를 `네트워크 주소`, `브로드캐스트 주소`라고 부른다. 네트워크주소는 네트워크 자체를 식별하는 대표주소이다. 브로드캐스트주소는 네트워크 내부에 있는 모든 IP주소에 데이터를 전송할 때 사용하는 주소다. 따라서 xx.xx.xx.255에 데이터를 전송하면 해당 네트워크에 연결된 모든 사설IP주소로 같은 데이터를 전송하게된다. 네트워크주소와 브로드캐스트주소는 이미 할당된 디폴트주소이므로 사설IP를 부여해서는 안된다.

## 서브넷(subnet)

기존에 클래스체계로만 IP를 할당하니 불필요하게 과도하게 많은 IP를 할당하는 경우가 생긴다. 이를 해결하기 위해서 네트워크 계층 안에서 네트워크를 작게 분할하는 것을 서브넷팅이라고 하고, 그 부분망을 `서브넷`이라고 한다. 이렇게 서브넷팅을 하면서 어디까지가 네트워크ID이고 어디부터 호스트ID인지 구분을 할 필요가 생겼는데 이를 `서브넷 마스크`를 사용하여 식별한다. 

서브넷 마스크는 255.0.0.0, 255.255.0.0, 255.255.255.0 과 같은 식으로 표기하거나 `프리픽스 표기법`을 사용하여 /24(비트수) 와 같은 식으로 표기가 가능하다.

네트워크를 나누기 위해서 호스트ID를 빌려서 서브넷ID를 부여할 수도 있으며 이를 서브넷 마스크를 통해서 식별, 구분한다.

## 라우팅과 라우터

어떤 경로를 통해서 목적지IP주소까지 데이터를 보낼지 결정하는 것을 `라우팅`이라고 한다. 라우팅을 수행해주는 장비를 라우터라고 부르는데, 이 라우터에는 `라우팅테이블` 이 있어서 경로정보를 등록하고 관리한다. 라우터가 네트워크를 구분해주는 역할을 수행하며 스위치는 네트워크를 분리할 수 없다. 

다르 네트워크에 있는 컴퓨터에 데이터를 전송하려고 할 때 전송을 하는 컴퓨터는 어떤 네트워크로 보내야하는지 알지 못한다. 이는 라우터에 라우팅테이블에 도달해야 알 수 있으므로 우선 네트워크의 출입구(게이트웨이)를 지정하고 라우터에 IP주소를 설정하는데 이를 `기본 게이트웨이(default gateway)`라고 부른다. 

라우팅 테이블은 직접 수동으로 정보를 등록할 수 도 있지만 보통 라우터끼리 정보를 교환해 자동으로 테이블을 구성한다. 이때 사용되는 프로토콜들이 있는데 이를 `라우팅 프로토콜`이라하며 대표적으로 RIP, OSPF, BGP가 있다.