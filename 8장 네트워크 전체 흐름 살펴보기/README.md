# 8장. 네트워크 전체 흐름 살펴보기

**OSI 모델의 전체 흐름:**

데이터의 흐름에 대한것

응용(세션,표현): 어플에서 사용하는 데이터를 주고 받음  
전송: **정확히** 목적지에 데이터를 전달  
네트워크: **다른 네트워크**에 있는 목적지에 데이터 전달  
데이터 링크: 랜에서 데이터를 주고 받는다  
물리: 데이터를 전기 신호로 변환한다.

## 랜카드

컴퓨터에서 `http://www.jijo-linux.com`을 치면 일어나는 일?  
(3-way handshake는 이미 완료되어 연결이 있다고 가정)
브라우저를 통해 웹사이트에 접속해야 하기 때문에 응용 계층에서 시작한다.url을 입력하고 엔터를 치면 캡슐화가 시작된다.

1. 브라우저를 통해 웹사이트에 접속하기 위해선 HTTP 프로토콜을 이용해 요청을 보낸다. `GET /index.html HTTP/1.1`과 같은 방식.
2. 이 데이터는 전송계층으로 전달되어 TCP 헤더가 붙는다. TCP헤더에는 출발지 포트와 목적지 포트가 있는데, 출발지는 well-known-port가 아닌 포트중 무작위, 목적지는 HTTP의 포트번호인 80이 붙는다. 이는 세그먼트가 된다.
3. 네트워크 계층에 전달된다. IP 헤더가 붙는다. 출발지IP와 목적지IP를 붙인 이 데이터는 IP 패킷이 된다.
4. 데이터 링크 계층. 이더넷 헤더가 추가된다. 이것은 이더넷 프레임.
5. 물리계층에서 랜카드를 통해 전기신호로 변환되어 전송된다.

## 스위치, 라우터

한가지 기기 에서 다른 기기로 갈때 캡슐화, 역캡슐화가 반복된다.

### 스위치에서의 데이터 처리

스위치는 데이터 링크 계층에서, 데이터를 전기신호로 변환해 라우터로 전송한다. (캡슐화)
데이터링크 - 물리 계층  
(이더넷 헤더와 트레일러를 붙인다. - 이더넷 헤더에는 목적지,출발지,라우터,컴퓨터의 MAC주소가 들어있고, 트레일러에는 데이터가 전송 도중 오류가 발생했는지 알려주는 역할.)

### 스위치 -> 라우터

(데이터 링크 -> 물리) 로 전달된 전기신호는 다시 (네트워크-> 데이터 링크 -> 물리 )과정을 거치면서 캡슐화, 역캡슐화를 거친다.
데이터링크 계층에서 **목적지 MAC주소가 자신의 MAC주소**와 맞는다면 역캡슐화를 진행.  
다음으로 네트워크 계층에서 라우팅 테이블과, 목적지 IP주소를 비교한다.
목적지의 IP주소가 라우팅 테이블에 있다면 라우팅이 가능하므로, IP헤더의 출발지 IP주소를 자신의 IP주소로 바꾼뒤 데이터링크-물리계층을 통해 전달한다.

위와 같이 캡슐화 - 역캡슐화의 반복으로 데이터가 전송된다.

## 웹서버

웹서버는 OSI 8계층을 다 거친다.

데이터링크에서, MAC 주소를 확인하고, 맞으면 헤더를 분리한다.
네트워크에서 목적지 IP주소를 확인하고, 맞으면 헤더를 분리한다.
전송계층에서 포트 번호를 비교하고, 맞으면 헤더를 분리한다.
응용계층에서 응답한다.
